@model TechWayFit.Licensing.Management.Web.ViewModels.OperationsDashboard.SystemHealthViewModel
@{
    ViewData["Title"] = "System Health";
    Layout = "~/Views/Shared/_LicenseHubLayout.cshtml";
}

<div class="container-fluid py-3">
    <!-- Header Section -->
    <div class="header mb-3">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h2 class="mb-1">System Health</h2>
                <p class="text-muted mb-0">Monitor overall system health and resource utilization.</p>
            </div>
            <div class="d-flex gap-2">
                <a href="@Url.Action("Index")" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-1"></i>Back to Dashboard
                </a>
                <button class="btn btn-outline-primary" onclick="refreshData()">
                    <i class="fas fa-sync-alt me-1"></i>Refresh
                </button>
            </div>
        </div>
    </div>

    @if (Model.CurrentHealth != null)
    {
        var latestSnapshot = Model.CurrentHealth;
        
        <!-- Health Status Cards -->
        <div class="row g-2 mb-3">
            <div class="col-sm-6 col-lg-3">
                <div class="stats-card @(latestSnapshot.OverallHealthStatus == "Healthy" ? "stats-card-success" : latestSnapshot.OverallHealthStatus == "Warning" ? "stats-card-warning" : "stats-card-danger")">
                    <div class="stats-row-1">
                        <div class="stats-icon">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <div class="stats-number">@latestSnapshot.OverallHealthStatus</div>
                    </div>
                    <div class="stats-row-2">
                        <div class="stats-label">Overall Health</div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-3">
                <div class="stats-card stats-card-info">
                    <div class="stats-row-1">
                        <div class="stats-icon">
                            <i class="fas fa-microchip"></i>
                        </div>
                        <div class="stats-number">@(latestSnapshot.CpuUsagePercent?.ToString("F1") ?? "N/A")%</div>
                    </div>
                    <div class="stats-row-2">
                        <div class="stats-label">CPU Usage</div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-3">
                <div class="stats-card stats-card-warning">
                    <div class="stats-row-1">
                        <div class="stats-icon">
                            <i class="fas fa-memory"></i>
                        </div>
                        <div class="stats-number">@(latestSnapshot.MemoryUsageMb?.ToString("F0") ?? "N/A") MB</div>
                    </div>
                    <div class="stats-row-2">
                        <div class="stats-label">Memory Usage</div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-3">
                <div class="stats-card stats-card-primary">
                    <div class="stats-row-1">
                        <div class="stats-icon">
                            <i class="fas fa-database"></i>
                        </div>
                        <div class="stats-number">@(latestSnapshot.ActiveDbConnections ?? 0)</div>
                    </div>
                    <div class="stats-row-2">
                        <div class="stats-label">DB Connections</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Current System Status -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="sidebar-section">
                    <div class="section-header">
                        <h5><i class="fas fa-chart-line me-2"></i>Current System Status</h5>
                    </div>
                    <div class="section-content">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <div class="text-center p-3 border rounded">
                                    <div class="h2 mb-2 text-@(latestSnapshot.OverallHealthStatus == "Healthy" ? "success" : latestSnapshot.OverallHealthStatus == "Warning" ? "warning" : "danger")">
                                        <i class="fas fa-@(latestSnapshot.OverallHealthStatus == "Healthy" ? "check-circle" : latestSnapshot.OverallHealthStatus == "Warning" ? "exclamation-triangle" : "times-circle")"></i>
                                    </div>
                                    <div class="fw-bold">@latestSnapshot.OverallHealthStatus</div>
                                    <small class="text-muted">Overall Status</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center p-3 border rounded">
                                    <div class="h4 mb-2 text-info">@latestSnapshot.TotalRequestsLastHour.ToString("N0")</div>
                                    <div class="fw-bold">Total Requests</div>
                                    <small class="text-muted">Last Hour</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center p-3 border rounded">
                                    <div class="h4 mb-2 @(latestSnapshot.TotalErrorsLastHour > 0 ? "text-danger" : "text-success")">
                                        @latestSnapshot.TotalErrorsLastHour.ToString("N0")
                                    </div>
                                    <div class="fw-bold">Errors</div>
                                    <small class="text-muted">Last Hour</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row g-3 mt-2">
                            <div class="col-md-6">
                                <div class="text-center p-3 border rounded">
                                    <div class="h5 mb-2 text-primary">@latestSnapshot.AvgResponseTimeMs ms</div>
                                    <div class="fw-bold">Avg Response Time</div>
                                    <small class="text-muted">Current Average</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="text-center p-3 border rounded">
                                    <div class="h5 mb-2 text-info">@latestSnapshot.SnapshotTimestamp.ToString("MMM dd, HH:mm:ss")</div>
                                    <div class="fw-bold">Last Updated</div>
                                    <small class="text-muted">Snapshot Time</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- Health History -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="sidebar-section">
                <div class="section-header">
                    <h5><i class="fas fa-history me-2"></i>Health Status</h5>
                </div>
                <div class="section-content">
                    @if (Model.CurrentHealth != null)
                    {
                        <div class="text-center py-5">
                            <div class="h1 text-success mb-3">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <h4>System is @Model.CurrentHealth.OverallHealthStatus</h4>
                            <p class="text-muted">Last updated: @Model.CurrentHealth.SnapshotTimestamp.ToString("MMM dd, yyyy HH:mm:ss")</p>
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-5">
                            <div class="h1 text-info mb-3">
                                <i class="fas fa-heartbeat"></i>
                            </div>
                            <h4>No Health Data</h4>
                            <p class="text-muted">No system health snapshots available. Health monitoring may be disabled or not yet started.</p>
                        </div>
                    }
                </div>
            </div>
        </div>
    <!-- Health Trends -->
    @if (Model.CurrentHealth != null)
    {
        <div class="row g-3">
            <div class="col-md-6">
                <div class="sidebar-section">
                    <div class="section-header">
                        <h5><i class="fas fa-chart-area me-2"></i>Current Status</h5>
                    </div>
                    <div class="section-content">
                        <div class="text-center p-4">
                            <div class="h1 text-@(Model.CurrentHealth.OverallHealthStatus == "Healthy" ? "success" : Model.CurrentHealth.OverallHealthStatus == "Warning" ? "warning" : "danger") mb-3">
                                <i class="fas fa-@(Model.CurrentHealth.OverallHealthStatus == "Healthy" ? "check-circle" : Model.CurrentHealth.OverallHealthStatus == "Warning" ? "exclamation-triangle" : "times-circle")"></i>
                            </div>
                            <h3>@Model.CurrentHealth.OverallHealthStatus</h3>
                            <p class="text-muted">System Status</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="sidebar-section">
                    <div class="section-header">
                        <h5><i class="fas fa-info-circle me-2"></i>System Info</h5>
                    </div>
                    <div class="section-content">
                        <div class="text-center py-3 text-success">
                            <i class="fas fa-server fa-2x mb-2"></i>
                            <p>System monitoring is active</p>
                            <small class="text-muted">Health data available</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script>
        function refreshData() {
            window.location.reload();
        }

        function loadMoreSnapshots() {
            alert('Load more health snapshots functionality would be implemented here');
        }

        // Auto-refresh every 30 seconds for health monitoring
        setInterval(function() {
            if (document.visibilityState === 'visible') {
                // Only refresh if page is visible
                window.location.reload();
            }
        }, 30000);
    </script>
}
