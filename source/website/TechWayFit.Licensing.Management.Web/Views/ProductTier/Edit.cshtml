@model TechWayFit.Licensing.Management.Web.ViewModels.Product.ProductTierViewModel

@{
    ViewData["Title"] = "Edit Product Tier";
    ViewData["PageTitle"] = "Edit Product Tier";
}

@section styles {
    <style>
        .tier-form {
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .form-section {
            margin-bottom: 24px;
        }
        
        .form-section h4 {
            color: #495057;
            margin-bottom: 16px;
            font-weight: 600;
        }
        
        .form-row {
            margin-bottom: 16px;
        }
        
        .price-row {
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            margin-bottom: 16px;
            background-color: #f8f9fa;
        }
        
        .currency-select {
            min-width: 100px;
        }
        
        .btn-group {
            gap: 12px;
        }
        
        .required-field {
            color: #dc3545;
        }
        
        .form-label {
            font-weight: 500;
            color: #495057;
        }
        
        .breadcrumb {
            background-color: transparent;
            padding: 0;
            margin-bottom: 24px;
        }
        
        .tier-info-badge {
            background-color: #e9ecef;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.875rem;
            color: #495057;
        }
    </style>
}

<div class="container-fluid">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="@Url.Action("Index", "Product")">Products</a>
            </li>
            <li class="breadcrumb-item">
                <a href="@Url.Action("Index", "ProductTier", new { productId = Model.ProductId })">Product Tiers</a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">Edit @Model.Name</li>
        </ol>
    </nav>

    <!-- Alert Messages -->
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-triangle"></i>
            @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle"></i>
            @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <div class="row">
        <div class="col-lg-8 col-md-10">
            <div class="tier-form">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3 class="mb-0">
                        <i class="fas fa-edit text-warning"></i>
                        Edit Product Tier
                    </h3>
                    <div class="tier-info-badge">
                        <i class="fas fa-info-circle"></i>
                        Tier ID: @Model.TierId
                    </div>
                </div>

                <form asp-action="Edit" asp-route-productId="@Model.ProductId" asp-route-tierId="@Model.TierId" method="post" novalidate>
                    @Html.AntiForgeryToken()
                    <input type="hidden" asp-for="ProductId" />
                    <input type="hidden" asp-for="TierId" />
                    
                    <!-- Basic Information Section -->
                    <div class="form-section">
                        <h4><i class="fas fa-info-circle"></i> Basic Information</h4>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-row">
                                    <label asp-for="Name" class="form-label">
                                        Tier Name <span class="required-field">*</span>
                                    </label>
                                    <input asp-for="Name" class="form-control" placeholder="Enter tier name" required />
                                    <span asp-validation-for="Name" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-row">
                                    <label asp-for="DisplayOrder" class="form-label">Display Order</label>
                                    <input asp-for="DisplayOrder" class="form-control" type="number" min="0" />
                                    <span asp-validation-for="DisplayOrder" class="text-danger"></span>
                                </div>
                            </div>
                        <!-- Support SLA Section -->
                        <div class="form-section">
                            <h4><i class="fas fa-headset me-2"></i>Support SLA Configuration</h4>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-row">
                                        <label asp-for="SLAName" class="form-label">SLA Name</label>
                                        <input asp-for="SLAName" class="form-control" placeholder="e.g., Premium Support" />
                                        <span asp-validation-for="SLAName" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-row">
                                        <label asp-for="SLADescription" class="form-label">SLA Description</label>
                                        <input asp-for="SLADescription" class="form-control" placeholder="Brief description of the support level" />
                                        <span asp-validation-for="SLADescription" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-row">
                                        <label asp-for="CriticalResponseHours" class="form-label">Critical Response Time (Hours)</label>
                                        <input asp-for="CriticalResponseHours" type="number" step="0.5" min="0.5" class="form-control" placeholder="1.0" />
                                        <span asp-validation-for="CriticalResponseHours" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-row">
                                        <label asp-for="HighPriorityResponseHours" class="form-label">High Priority Response Time (Hours)</label>
                                        <input asp-for="HighPriorityResponseHours" type="number" step="0.5" min="0.5" class="form-control" placeholder="4.0" />
                                        <span asp-validation-for="HighPriorityResponseHours" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-row">
                                        <label asp-for="MediumPriorityResponseHours" class="form-label">Medium Priority Response Time (Hours)</label>
                                        <input asp-for="MediumPriorityResponseHours" type="number" step="0.5" min="0.5" class="form-control" placeholder="8.0" />
                                        <span asp-validation-for="MediumPriorityResponseHours" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-row">
                                        <label asp-for="LowPriorityResponseHours" class="form-label">Low Priority Response Time (Hours)</label>
                                        <input asp-for="LowPriorityResponseHours" type="number" step="0.5" min="0.5" class="form-control" placeholder="24.0" />
                                        <span asp-validation-for="LowPriorityResponseHours" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>

                        <div class="form-row">
                            <label asp-for="Description" class="form-label">Description</label>
                            <textarea asp-for="Description" class="form-control" rows="3" placeholder="Enter tier description"></textarea>
                            <span asp-validation-for="Description" class="text-danger"></span>
                        </div>
                    </div>

                    <!-- Limits Section -->
                    <div class="form-section">
                        <h4><i class="fas fa-users"></i> Usage Limits</h4>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-row">
                                    <label asp-for="MaxUsers" class="form-label">Maximum Users</label>
                                    <input asp-for="MaxUsers" class="form-control" type="number" min="0" placeholder="0 = unlimited" />
                                    <span asp-validation-for="MaxUsers" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-row">
                                    <label asp-for="MaxDevices" class="form-label">Maximum Devices</label>
                                    <input asp-for="MaxDevices" class="form-control" type="number" min="0" placeholder="0 = unlimited" />
                                    <span asp-validation-for="MaxDevices" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pricing Section -->
                    <div class="form-section">
                        <h4><i class="fas fa-dollar-sign"></i> Pricing</h4>
                        
                        <!-- Monthly Pricing -->
                        <div class="price-row">
                            <h6 class="mb-3"><i class="fas fa-calendar-alt"></i> Monthly Pricing</h6>
                            <div class="row">
                                <div class="col-md-8">
                                    <label asp-for="MonthlyPriceAmount" class="form-label">Monthly Price</label>
                                    <input asp-for="MonthlyPriceAmount" class="form-control" type="number" step="0.01" min="0" placeholder="0.00" />
                                    <span asp-validation-for="MonthlyPriceAmount" class="text-danger"></span>
                                </div>
                                <div class="col-md-4">
                                    <label asp-for="MonthlyPriceCurrency" class="form-label">Currency</label>
                                    <select asp-for="MonthlyPriceCurrency" class="form-select currency-select">
                                        <option value="USD">USD ($)</option>
                                        <option value="EUR">EUR (€)</option>
                                        <option value="GBP">GBP (£)</option>
                                    </select>
                                    <span asp-validation-for="MonthlyPriceCurrency" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Annual Pricing -->
                        <div class="price-row">
                            <h6 class="mb-3"><i class="fas fa-calendar"></i> Annual Pricing</h6>
                            <div class="row">
                                <div class="col-md-8">
                                    <label asp-for="AnnualPriceAmount" class="form-label">Annual Price</label>
                                    <input asp-for="AnnualPriceAmount" class="form-control" type="number" step="0.01" min="0" placeholder="0.00" />
                                    <span asp-validation-for="AnnualPriceAmount" class="text-danger"></span>
                                </div>
                                <div class="col-md-4">
                                    <label asp-for="AnnualPriceCurrency" class="form-label">Currency</label>
                                    <select asp-for="AnnualPriceCurrency" class="form-select currency-select">
                                        <option value="USD">USD ($)</option>
                                        <option value="EUR">EUR (€)</option>
                                        <option value="GBP">GBP (£)</option>
                                    </select>
                                    <span asp-validation-for="AnnualPriceCurrency" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Status Section -->
                    <div class="form-section">
                        <h4><i class="fas fa-toggle-on"></i> Status</h4>
                        
                        <div class="form-check">
                            <input asp-for="IsActive" class="form-check-input" type="checkbox" />
                            <label asp-for="IsActive" class="form-check-label">
                                Active (Available for licensing)
                            </label>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-flex justify-content-end btn-group">
                        <a href="@Url.Action("Index", new { productId = Model.ProductId })" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-warning">
                            <i class="fas fa-save"></i> Update Tier
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        $(document).ready(function() {
            // Auto-sync currency selections
            $('#MonthlyPriceCurrency').on('change', function() {
                if (!$('#AnnualPriceAmount').val()) {
                    $('#AnnualPriceCurrency').val($(this).val());
                }
            });

            $('#AnnualPriceCurrency').on('change', function() {
                if (!$('#MonthlyPriceAmount').val()) {
                    $('#MonthlyPriceCurrency').val($(this).val());
                }
            });

            // Form validation enhancement
            $('form').on('submit', function(e) {
                const monthlyPrice = parseFloat($('#MonthlyPriceAmount').val()) || 0;
                const annualPrice = parseFloat($('#AnnualPriceAmount').val()) || 0;
                
                if (monthlyPrice === 0 && annualPrice === 0) {
                    e.preventDefault();
                    alert('Please specify at least one price (monthly or annual) for this tier.');
                    return false;
                }
                
                return true;
            });

            // Auto-dismiss alerts after 5 seconds
            setTimeout(function() {
                $('.alert').fadeOut();
            }, 5000);

            // Highlight changed fields
            let originalValues = {};
            $('input, select, textarea').each(function() {
                originalValues[this.id] = $(this).val();
            });

            $('input, select, textarea').on('change', function() {
                if ($(this).val() !== originalValues[this.id]) {
                    $(this).addClass('border-warning');
                } else {
                    $(this).removeClass('border-warning');
                }
            });
        });
    </script>
}
